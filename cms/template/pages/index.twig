{% extends "base.twig" %}
{# Page Title #}
{% block page_title %}
    Welcome Daniel prince!
{% endblock %}


{% block content %}
    <!-- Fetch Total Records from the relevant table  -->
    <?php
        use Backend\Database\Tables\ILove;
        use Backend\Database\Tables\Memory;
        use Backend\Database\Tables\Poems;
        use Backend\Database\Tables\Promises;
        use Backend\Database\Tables\Reassurance;

        $poems      = new Poems();
        $totalPoems = (int)$poems->totalRows();

    $iloves      = new ILove($poems->getConnection());
    $totalIloves = (int)$iloves->totalRows();

    $assure      = new Reassurance($poems->getConnection());
    $totalAssure = (int)$assure->totalRows();

    $promise      = new Promises($poems->getConnection());
    $totalPromise = (int)$promise->totalRows();

    $memory      = new Memory($poems->getConnection());
    $totalMemory = (int)$memory->totalRows();

    $total = $totalPoems + $totalIloves + $totalAssure + $totalPromise + $totalMemory;
    ?>
    <!--Widget-4 -->
    <div class="row">
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalPoems ?></span>
                    Total Poems
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalPoems ?></span>
                    Total Quotes
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalIloves ?></span>
                    Total ILoves
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalAssure ?></span>
                    Total Reassurance
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalPromise ?></span>
                    Total Promises
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $totalMemory ?></span>
                    Total Memory
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter">0</span>
                    Total Requests
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-6 col-lg-3">
            <div class="mini-stat clearfix bx-shadow">
                <div class="mini-stat-info text-center text-muted">
                    <span class="counter"><?php echo $total ?></span>
                    Total Posts
                </div>
            </div>
        </div>
    </div>
    <!-- End Widget row-->

    <!-- Pie Chart -->
    <div class="row">

        <div class="col-lg-7">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Todo</h3>
                </div>
                <div class="panel-body todoapp">
                    <div class="row">
                        <div class="col-sm-6">
                            <h4 id="todo-message"><span id="todo-remaining"></span> of <span
                                        id="todo-total"></span> remaining</h4>
                        </div>
                        <div class="col-sm-6">
                            <a href="" class="pull-right btn btn-primary btn-sm"
                               id="btn-archive">Archive</a>
                        </div>
                    </div>

                    <ul class="list-group no-margn nicescroll todo-list" style="max-height: 288px;"
                        id="todo-list"></ul>

                    <form name="todo-form" id="todo-form" role="form" class="m-t-20">
                        <div class="row">
                            <div class="col-sm-9 todo-inputbar">
                                <input type="text" id="todo-input-text" name="todo-input-text"
                                       class="form-control" placeholder="Add new todo">
                            </div>
                            <div class="col-sm-3 todo-send">
                                <button class="btn-info btn-block btn" type="button" id="todo-btn-submit">
                                    Add
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="panel panel-border panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Statistics</h3>
                </div>
                <div class="panel-body">
                    <div id="pie-chart">
                        <div id="pie-chart-container" class="flot-chart" style="height: 320px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- End of Pie Chart-->
{% endblock %}

{% block scripts %}
    <!-- Counter-up -->
    <script src="assets/counterup/waypoints.min.js" type="text/javascript"></script>
    <script src="assets/counterup/jquery.counterup.min.js" type="text/javascript"></script>
    {# For Count Up#}
    <script>
        jQuery(document).ready(function ($) {
            /* Counter Up */
            $('.counter').counterUp({
                delay: 100,
                time : 1200
            });
        });
    </script>

    {# Todo List #}
    <!-- Todo -->
    <script src="js/vendor/jquery.todo.js"></script>


    {# Pie Chart #}
    {# custom scripts needed #}
    <script src="js/scripts/Ajaxify.js"></script>
    <script src="js/scripts/classes/Manager.js"></script>

    {# base scriprs#}
    <script src="assets/flot-chart/jquery.flot.js"></script>
    <script src="assets/flot-chart/jquery.flot.time.js"></script>
    <script src="assets/flot-chart/jquery.flot.tooltip.min.js"></script>
    <script src="assets/flot-chart/jquery.flot.resize.js"></script>
    <script src="assets/flot-chart/jquery.flot.pie.js"></script>
    <script src="assets/flot-chart/jquery.flot.selection.js"></script>
    <script src="assets/flot-chart/jquery.flot.stack.js"></script>
    <script src="assets/flot-chart/jquery.flot.crosshair.js"></script>

    <script src="js/scripts/classes/PieChart.js"></script>
    <script>
        var pieC = new PieChart(null, null, [
                    "#058DC7",
                    "#FF6F34",
                    "#50B432"
                ]),
                data = [];

        var iloveManager = new Manager("ilove.php"),
                memoryManager = new Manager("memory.php"),
                poemManager = new Manager("poem.php"),
                promiseManager = new Manager("promise.php"),
                reassureManager = new Manager("reassure.php");

        var success = function (text) {
                    if (text.length <= 0) {
                        text = 0;
                    }
                    data.push(text);
                    createGraph();
                },
                fail = function () {
                    data.push(0);
                };
        var requestParams = {
            total: "totalRowsPlease"
        };

        iloveManager.performRequest(success, fail, requestParams, "GET");
        memoryManager.performRequest(success, fail, requestParams, "GET");
        poemManager.performRequest(success, fail, requestParams, "GET");
        promiseManager.performRequest(success, fail, requestParams, "GET");
        reassureManager.performRequest(success, fail, requestParams, "GET");

        function createGraph() {
            if (data.length === 5) {
                var newDataSet  = [],
                    newLabelSet = [];
                for (var i = 0; i < data.length; i++) {
                    var posOfSpace = data[i].indexOf(" ");
                    var value      = data[i].substr(0, posOfSpace),
                        label      = data[i].substr(posOfSpace).toUpperCase();
                    newDataSet.push(parseInt(value));
                    newLabelSet.push(label);
                    console.log(label + " " + value);
                }
                pieC.setData(newDataSet);
                pieC.setLabels(newLabelSet);
                pieC.createGraph();
            }
        }
    </script>
{% endblock %}

